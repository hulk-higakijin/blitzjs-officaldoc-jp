---
title: ã‚¯ã‚¨ãƒªã®ä½¿ç”¨
sidebar_label: ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨
---

## React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ {#in-a-react-component}

[Blitz ã®ã‚¯ã‚¨ãƒª](./query-resolvers)ã®ä¸€ã¤ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€`useQuery` ãƒ•ãƒƒã‚¯ã‚’æ¬¡ã®ã‚ˆã†ã«å‘¼ã³å‡ºã—ã¾ã™:

1. ã‚¯ã‚¨ãƒªãƒªã‚¾ãƒ«ãƒ
2. ã‚¯ã‚¨ãƒªé–¢æ•°ã®å…¥åŠ›å¼•æ•°
3. å¿…è¦ã«å¿œã˜ã¦ã€è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚

ãã‚Œã¯ã“ã®ã‚¿ãƒ—ãƒ«é…åˆ—ã€`[queryResult, queryExtras]`ã‚’è¿”ã—ã¾ã™ã€‚ã“ã®ä¸­ã§ `queryResult` ã¯ã‚¯ã‚¨ãƒªé–¢æ•°ã‹ã‚‰è¿”ã•ã‚ŒãŸã‚‚ã®ã¨å…¨ãåŒã˜ã§ã™ã€‚

`useQuery` ã¯ [`react-query`](https://github.com/tannerlinsley/react-query) ä¸Šã«æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„å†æ¤œè¨¼ãªã©ã®ç´ æ™´ã‚‰ã—ã„æ©Ÿèƒ½ãŒè‡ªå‹•çš„ã«æä¾›ã•ã‚Œã¾ã™ã€‚

```ts
import { useQuery } from "@blitzjs/rpc"
import getProject from "src/projects/queries/getProject"

function App() {
  const [project] = useQuery(getProject, { where: { id: 1 } })
}
```

è©³ç´°ã«ã¤ã„ã¦ã¯ã€[`useQuery` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./use-query)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

<Card type="info" title="ğŸ¤”">

ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã®ã«ã€ã©ã†ã‚„ã£ã¦å‹•ä½œã™ã‚‹ã®ã‹ã¨æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“: ãƒ“ãƒ«ãƒ‰æ™‚ã«ã€ç›´æ¥é–¢æ•°ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‘¼ã³å‡ºã—ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚¯ã‚¨ãƒªé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã«ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚

</Card>

### è¦šãˆã¦ãŠãã¹ããƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š {#defaults-to-keep-in-mind}

åˆã‚ã‹ã‚‰ã€`useQuery` ãŠã‚ˆã³ãã®ä»–ã®ã‚¯ã‚¨ãƒªãƒ•ãƒƒã‚¯ã¯**ç©æ¥µçš„ã ãŒåˆç†çš„ãª**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãŒæ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚**ã“ã‚Œã‚‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€æ™‚ã«ã¯æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ä¸æ„ã‚’ã¤ãã“ã¨ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã—ã€å­¦ç¿’ã‚„ãƒ‡ãƒãƒƒã‚°ã‚’å›°é›£ã«ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚**:

- _ç¾åœ¨ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹_ã‚¯ã‚¨ãƒªã®çµæœã¯ã€è§£æ±ºå¾Œã™ãã«ã€Œå¤ã„ã€ã‚‚ã®ã¨ãªã‚Šã€å†åº¦è¡¨ç¤ºã¾ãŸã¯ä½¿ç”¨ã•ã‚Œã‚‹ã¨ãã«è‡ªå‹•çš„ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å†å–å¾—ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€ã‚¯ã‚¨ãƒªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`staleTime`ã‚’`0`ãƒŸãƒªç§’ä»¥å¤–ã®ã‚‚ã®ã«å¤‰æ›´ã§ãã¾ã™ã€‚
- ä½¿ç”¨ã•ã‚Œãªããªã£ãŸã‚¯ã‚¨ãƒªçµæœï¼ˆã‚¯ã‚¨ãƒªã®ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ï¼‰ã¯ã€å†åº¦ä½¿ç”¨ã•ã‚Œã‚‹å ´åˆã«å‚™ãˆã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯5åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã€ãã®å¾Œã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€ã‚¯ã‚¨ãƒªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`cacheTime`ã‚’`1000 * 60 * 5`ãƒŸãƒªç§’ä»¥å¤–ã®ã‚‚ã®ã«å¤‰æ›´ã§ãã¾ã™ã€‚
- å¤ã„ã‚¯ã‚¨ãƒªã¯ã€**ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦å†ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚ŒãŸã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒå†æ¥ç¶šã•ã‚ŒãŸã‚Šã—ãŸã¨ãã«**è‡ªå‹•çš„ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å†å–å¾—ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’ç„¡åŠ¹ã«ã™ã‚‹ã«ã¯ã€ã‚¯ã‚¨ãƒªå†…ã®`refetchOnWindowFocus`ãŠã‚ˆã³`refetchOnReconnect`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®ãŸã‚ã«æœ¬ç•ªç’°å¢ƒã§å¤±æ•—ã—ãŸã‚¯ã‚¨ãƒªã¯ã€**æŒ‡æ•°çš„ãƒãƒƒã‚¯ã‚ªãƒ•é…å»¶ã‚’ä¼´ã†3å›ã®å†è©¦è¡Œ**ãŒè‡ªå‹•çš„ã«è¡Œã‚ã‚ŒãŸå¾Œã€UIã«ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã“ã‚Œã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€ã‚¯ã‚¨ãƒªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`retry`ãŠã‚ˆã³`retryDelay`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´ã—ã¾ã™ã€‚
- ã‚¯ã‚¨ãƒªçµæœã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ·±ã„æ¯”è¼ƒãŒè¡Œã‚ã‚Œã€ãƒ‡ãƒ¼ã‚¿ãŒå®Ÿéš›ã«å¤‰æ›´ã•ã‚ŒãŸã‹ã©ã†ã‹ãŒæ¤œå‡ºã•ã‚Œã¾ã™ã€‚å¤‰æ›´ãŒãªã‘ã‚Œã°ã€ãƒ‡ãƒ¼ã‚¿å‚ç…§ã¯å¤‰æ›´ã•ã‚Œãšã€useMemoã‚„useCallbackã¨ã®é–¢é€£ã§å€¤ã®å®‰å®šåŒ–ãŒå‘ä¸Šã—ã¾ã™ã€‚ã“ã“ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ·±ã„æ¯”è¼ƒé–¢æ•°ï¼ˆ`config.isDataEqual`ï¼‰ã¯ã€JSONäº’æ›ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã®ã¿ã‚’æ¯”è¼ƒã™ã‚‹ã“ã¨ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ã‚¯ã‚¨ãƒªå¿œç­”ã§éJSONäº’æ›ã®å€¤ã‚’æ‰±ã£ã¦ã„ã‚‹å ´åˆã‚„ã€æ·±ã„æ¯”è¼ƒé–¢æ•°ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹å ´åˆã€ã“ã®æ¯”è¼ƒã‚’ç„¡åŠ¹ã«ã™ã‚‹ï¼ˆ`config.isDataEqual = () => false`ï¼‰ã‹ã€ã‚ˆã‚Šãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã¹ãã§ã™ã€‚

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ {#options}

åˆ©ç”¨å¯èƒ½ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å®Œå…¨ãªãƒªã‚¹ãƒˆã«ã¤ã„ã¦ã¯ã€[`useQuery` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./use-query)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### å¾“å±ã‚¯ã‚¨ãƒª {#dependent-queries}

å¾“å±ã‚¯ã‚¨ãƒªã¯ã€å‰ã®ã‚¯ã‚¨ãƒªãŒçµ‚äº†ã™ã‚‹ã¾ã§å®Ÿè¡Œã•ã‚Œãªã„ã‚¯ã‚¨ãƒªã§ã™ã€‚ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ã‚¯ã‚¨ãƒªãŒå‹•ä½œã™ã‚‹æº–å‚™ãŒã§ããŸã¨ãã«çŸ¥ã‚‰ã›ã‚‹ãŸã‚ã« enabled ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™:

```tsx
const [user] = useQuery(getUser, { where: { id: props.query.id } })
const [projects] = useQuery(getProjects, { where: { userId: user.id } }, { enabled: user }))
```

### ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ {#pagination}

[`usePaginatedQuery`](./use-paginated-query) ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« {#infinite-loading}

[`useInfiniteQuery`](./use-infinite-query) ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ {#prefetching}

ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªã¯è‡ªå‹•çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ãŸã‚ã€æ¬¡ã®ã©ã¡ã‚‰ã‚‚ `getProject` ã‚¯ã‚¨ãƒªã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚

```ts
import { invoke } from "@blitzjs/rpc"

const project = await invoke(getProject, { where: { id: props.id } })
```

```tsx
<a onMouseEnter={() => invoke(getProject, { where: { id: props.id } })}>
  View Project
</a>
```

Blitz ã¯ã‚µãƒ¼ãƒãƒ¼ä¸Šã§è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã—ã€ãã®ã‚¯ã‚¨ãƒªã‚’å†…éƒ¨ã®ã‚¯ã‚¨ãƒªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ‡ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Blitz ã¯ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å³åº§ã«åˆ©ç”¨ã§ãã‚‹ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—ã‚’äº‹å‰ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã«JavaScriptãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã¨ã€Blitzã¯ã“ã‚Œã‚‰ã®ã‚¯ã‚¨ãƒªã‚’ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ãƒˆã—ã€ã‚µãƒ¼ãƒãƒ¼ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸå¾Œã«å¤ããªã£ãŸå ´åˆã¯å†å–å¾—ã—ã¾ã™ã€‚

æ¬¡ã®ä¾‹ã¯ã€Blitz ã«ãŠã‘ã‚‹ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã®å‹•ä½œã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```tsx
import { gSSP } from "src/blitz-server"
import getProject from "src/projects/queries/getProject"

export const getServerSideProps = gSSP(async ({ ctx }) => {
  // é‡è¦: prefetchBlitzQuery ã®ç¬¬äºŒå¼•æ•°ã¯ã€ä¸‹è¨˜ã® useQuery ã®ç¬¬äºŒå¼•æ•°ã¨æ­£ç¢ºã«ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
  await context.prefetchBlitzQuery(getProject, {
    where: { id: context.params?.projectId },
  })

  return { props: {} }
})

function ProjectPage(props) {
  const [project] = useQuery(getProject, { where: { id: props.id } })
  return <div>{project.name}</div>
}

export default ProjectPage
```

ãƒ‡ãƒ¼ã‚¿ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“ã§å…±æœ‰ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€æ–°ã—ã„ã‚¯ã‚¨ãƒªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå„ãƒšãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãŸã‚ã«ä½œæˆã•ã‚Œã¾ã™ã€‚`ctx` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§åˆ©ç”¨å¯èƒ½ãª `prefetchBlitzQuery` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€ãƒªã‚¾ãƒ«ãƒã¨é–¢é€£ã™ã‚‹å…¥åŠ›å¼•æ•°ã‚’æ¸¡ã™ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã§ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã‚‹ã¨ã€Blitz ã¯ã‚¯ã‚¨ãƒªã‚’ã‚¯ã‚¨ãƒªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ‡ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ãƒˆã™ã‚‹å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

### ã‚¯ã‚¨ãƒªã®ã‚­ãƒ£ãƒ³ã‚»ãƒ« {#query-cancellation}

Blitz ã¯ React Query ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒ³ã‚»ãƒ«æ–¹æ³•ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ã“ã¡ã‚‰ã§èª­ã‚€ã“ã¨ãŒã§ãã¾ã™:
[here](https://react-query-v2.tanstack.com/guides/query-cancellation).

ã¾ãŸã€`cancelQueries` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦æ‰‹å‹•ã§ã‚¯ã‚¨ãƒªã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:

```tsx
import { getQueryClient, getQueryKey, useQuery } from "@blitzjs/rpc"

const [data] = useQuery(getTodos)

return (
  <button
    onClick={(e) => {
      e.preventDefault()
      getQueryClient.cancelQueries(getQueryKey(getTodos))
    }}
  >
    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  </button>
)
```

## ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ {#on-the-server}

:::message
`getStaticProps` ã¾ãŸã¯ `getServerSideProps` ã§ã¯ã€ã‚¯ã‚¨ãƒªãŠã‚ˆã³ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚
:::

### `getStaticProps` {#get-static-props}

```tsx
import getProject from "src/projects/queries/getProject"
import { gSP } from "src/blitz-server"

export const getStaticProps = gSP(async ({ params, ctx }) => {
  const project = await getProject({
    where: { id: context.params?.projectId },
  })
  return { props: { project } }
})

function ProjectPage({ project }) {
  return <div>{project.name}</div>
}

export default ProjectPage
```

### `getServerSideProps` {#get-server-side-props}

```tsx
import getProject from "src/projects/queries/getProject"
import { gSSP } from "src/blitz-server"

export const getServerSideProps = gSSP(async ({ params, ctx }) => {
  const project = await getProject({
    where: { id: params.projectId },
  })

  return { props: { project } }
})

function ProjectPage({ project }) {
  return <div>{project.name}</div>
}

export default ProjectPage
```
